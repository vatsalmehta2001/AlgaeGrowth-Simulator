---
phase: 01-foundation-core-model
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/__init__.py
  - src/simulation/__init__.py
  - src/models/__init__.py
  - src/config/__init__.py
  - src/models/parameters.py
  - src/models/results.py
  - src/config/species_params.yaml
  - src/config/loader.py
  - tests/__init__.py
  - tests/test_parameters.py
autonomous: true

must_haves:
  truths:
    - "Parameter dataclasses are frozen (immutable) and hashable"
    - "YAML config loads Chlorella vulgaris parameters with per-parameter citations"
    - "Loader validates parameter ranges and rejects invalid values"
    - "All parameter values match conservative ends from Schediwy/Razzak sources"
  artifacts:
    - path: "pyproject.toml"
      provides: "Project metadata, dependencies, tool config"
      contains: "numpy"
    - path: "src/models/parameters.py"
      provides: "GrowthParams, LightParams, ReactorParams, SpeciesParams frozen dataclasses"
      exports: ["GrowthParams", "LightParams", "ReactorParams", "SpeciesParams"]
    - path: "src/models/results.py"
      provides: "SimulationResult dataclass for downstream phases"
      exports: ["SimulationResult"]
    - path: "src/config/species_params.yaml"
      provides: "Chlorella vulgaris kinetic parameters with citations"
      contains: "Schediwy"
    - path: "src/config/loader.py"
      provides: "YAML loading with Pydantic validation"
      exports: ["load_species_params"]
  key_links:
    - from: "src/config/loader.py"
      to: "src/config/species_params.yaml"
      via: "PyYAML load + Pydantic parse"
      pattern: "yaml\\.safe_load"
    - from: "src/config/loader.py"
      to: "src/models/parameters.py"
      via: "Returns SpeciesParams dataclass"
      pattern: "SpeciesParams"
---

<objective>
Create the project foundation: Python package structure, frozen parameter dataclasses, YAML species config with citations, and a validated config loader.

Purpose: Everything in Phase 1 (and beyond) depends on parameter types and config loading. This establishes the data contract that growth.py, light.py, and the ODE engine all consume. Frozen dataclasses ensure hashability for Streamlit caching in Phase 4.

Output: Working Python package with `pip install -e .`, parameter types importable from `src.models.parameters`, and `load_species_params()` returning validated Chlorella vulgaris parameters.
</objective>

<execution_context>
@/Users/vatsalmehta/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vatsalmehta/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-core-model/01-CONTEXT.md
@.planning/phases/01-foundation-core-model/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Project scaffolding and dependencies</name>
  <files>
    pyproject.toml
    src/__init__.py
    src/simulation/__init__.py
    src/models/__init__.py
    src/config/__init__.py
    tests/__init__.py
  </files>
  <action>
Create pyproject.toml with:
- Project name: `algaegrowth-simulator`
- Python >= 3.12
- Dependencies: numpy>=2.4.1, scipy>=1.17.0, pydantic>=2.12.5, pyyaml>=6.0
- Dev dependencies group: pytest>=8.0.0, mypy>=1.8.0, ruff>=0.1.0
- pytest config: testpaths = ["tests"], pythonpath = ["."]
- ruff config: line-length = 100, target-version = "py312"

Create empty __init__.py files for all packages:
- src/__init__.py
- src/simulation/__init__.py
- src/models/__init__.py
- src/config/__init__.py
- tests/__init__.py

Run `pip install -e ".[dev]"` to install the package in development mode.

Do NOT use setup.py or setup.cfg (legacy). pyproject.toml is the modern standard.
  </action>
  <verify>
Run: `python -c "import src; print('OK')"` — should print OK.
Run: `pip show algaegrowth-simulator` — should show installed package.
Run: `pytest --collect-only` — should discover test directory (0 tests is fine).
  </verify>
  <done>
Package installs without errors. All subpackages importable. pytest discovers test directory.
  </done>
</task>

<task type="auto">
  <name>Task 2: Frozen parameter dataclasses and results model</name>
  <files>
    src/models/parameters.py
    src/models/results.py
  </files>
  <action>
Create src/models/parameters.py with four frozen dataclasses:

1. **GrowthParams** (frozen=True):
   - mu_max: float — Maximum specific growth rate [1/d]
   - Ks_co2: float — Half-saturation constant for CO2 [mg/L]
   - I_opt: float — Optimal light intensity for Steele model [umol/m2/s]
   - r_maintenance: float — Maintenance respiration rate [1/d]
   - discount_factor: float — Real-world discount (0-1), typically 0.5

2. **LightParams** (frozen=True):
   - sigma_x: float — Biomass-specific light absorption [m2/g]
   - background_turbidity: float — Non-biomass light extinction [1/m]

3. **ReactorParams** (frozen=True):
   - depth: float — Pond depth [m]
   - surface_area: float — Pond surface area [m2]

4. **SpeciesParams** (frozen=True):
   - name: str — Species name
   - growth: GrowthParams
   - light: LightParams
   - carbon_content: float — Fraction of biomass that is carbon [g_C/g_DW]
   - co2_to_biomass_ratio: float — g_CO2 per g_DW biomass

Each field must have a docstring-style comment explaining the unit and meaning. Use `from dataclasses import dataclass`. Do NOT use Pydantic for the dataclasses themselves (Pydantic is for validation in the loader only). Frozen dataclasses are simpler and natively hashable.

Create src/models/results.py with:

1. **SimulationResult** (frozen=True):
   - time_days: tuple[float, ...] — Time points
   - biomass_concentration: tuple[float, ...] — Biomass [g/L] at each time
   - productivity_areal: tuple[float, ...] — Areal productivity [g/m2/day]
   - co2_captured_cumulative: tuple[float, ...] — Cumulative CO2 [g/m2]
   - warnings: tuple[str, ...] — Any warnings (e.g., "exceeds 10 g/m2/day")
   - parameters_used: SpeciesParams — Parameters for audit trail

Use tuple (not list) for all sequence fields so they are hashable. Include a `peak_productivity` property that returns the max of productivity_areal.

Update src/models/__init__.py to export all dataclasses.
  </action>
  <verify>
Run in Python:
```
from src.models.parameters import GrowthParams, LightParams, ReactorParams, SpeciesParams
gp = GrowthParams(mu_max=1.0, Ks_co2=0.5, I_opt=80.0, r_maintenance=0.01, discount_factor=0.5)
hash(gp)  # Must not raise
gp.mu_max = 2.0  # Must raise FrozenInstanceError
```
  </verify>
  <done>
All four parameter dataclasses are frozen and hashable. SimulationResult has tuple fields and a peak_productivity property. Attempting mutation raises FrozenInstanceError.
  </done>
</task>

<task type="auto">
  <name>Task 3: YAML species config with citations and validated loader</name>
  <files>
    src/config/species_params.yaml
    src/config/loader.py
    tests/test_parameters.py
  </files>
  <action>
Create src/config/species_params.yaml with the complete Chlorella vulgaris parameter set from RESEARCH.md. Each parameter entry must have:
- value: the numeric value
- unit: the unit string
- source: paper reference (e.g., "Schediwy et al. (2019), Table 2")
- note: any additional context (mark ASSUMED values explicitly)

Parameters to include (use conservative values from RESEARCH.md):
- growth.mu_max: 1.0 (1/d) — Schediwy Table 2, conservative mid-range for C. vulgaris
- growth.Ks_co2: 0.5 (mg/L) — Schediwy Table 2
- growth.I_opt: 80.0 (umol/m2/s) — Razzak (2024), citing Metsoviti
- growth.r_maintenance: 0.01 (1/d) — ASSUMED, general microalgae literature
- growth.discount_factor: 0.5 — Schediwy; 40-60% range midpoint
- light.sigma_x: 0.2 (m2/g) — Schediwy Table 2, midpoint of 0.1-0.3
- light.background_turbidity: 0.5 (1/m) — ASSUMED, open pond estimate
- carbon.carbon_content: 0.50 (g_C/g_DW) — Schediwy Table 2
- carbon.co2_to_biomass_ratio: 1.83 (g_CO2/g_DW) — Derived: (44/12)*0.50

Create src/config/loader.py with:
1. A Pydantic model `SpeciesParamsValidator` that validates ranges:
   - mu_max: 0.1-5.0 (1/d)
   - Ks_co2: 0.01-10.0 (mg/L)
   - I_opt: 10-500 (umol/m2/s)
   - r_maintenance: 0-0.1 (1/d)
   - discount_factor: 0.1-1.0
   - sigma_x: 0.01-1.0 (m2/g)
   - background_turbidity: 0-5.0 (1/m)
   - carbon_content: 0.3-0.7 (g_C/g_DW)
   - co2_to_biomass_ratio: 1.0-3.0 (g_CO2/g_DW)

2. Function `load_species_params(path: str | Path | None = None) -> SpeciesParams`:
   - If path is None, default to the bundled species_params.yaml (use `pathlib.Path(__file__).parent / "species_params.yaml"`)
   - Load YAML with `yaml.safe_load`
   - Extract numeric values from the nested value/unit/source structure
   - Validate through Pydantic model
   - Return a frozen SpeciesParams dataclass (not the Pydantic model)

3. Function `get_parameter_citations(path: str | Path | None = None) -> dict`:
   - Returns the full YAML data with citations for transparency display

Create tests/test_parameters.py with:
- test_default_params_load: `load_species_params()` returns SpeciesParams with expected values
- test_params_are_frozen: Mutation raises FrozenInstanceError
- test_params_are_hashable: hash() works on all param types
- test_species_name: Returns "Chlorella vulgaris"
- test_invalid_params_rejected: Out-of-range values raise ValidationError
- test_citations_available: `get_parameter_citations()` returns dict with "source" keys
- test_assumed_params_flagged: Parameters marked ASSUMED have "ASSUMED" in their note field

Update src/config/__init__.py to export load_species_params and get_parameter_citations.
  </action>
  <verify>
Run: `pytest tests/test_parameters.py -v` — all tests pass.
Run: `python -c "from src.config.loader import load_species_params; p = load_species_params(); print(p.name, p.growth.mu_max, p.growth.discount_factor)"` — should print "Chlorella vulgaris 1.0 0.5".
  </verify>
  <done>
YAML config loads successfully with all Chlorella vulgaris parameters. Pydantic validates ranges. Frozen dataclasses are returned. Citations are accessible. ASSUMED parameters are flagged. All 7+ tests pass.
  </done>
</task>

</tasks>

<verification>
1. `pip install -e ".[dev]"` succeeds
2. `pytest tests/test_parameters.py -v` — all tests pass
3. `python -c "from src.models.parameters import GrowthParams; hash(GrowthParams(mu_max=1.0, Ks_co2=0.5, I_opt=80.0, r_maintenance=0.01, discount_factor=0.5))"` — no error
4. `python -c "from src.config.loader import load_species_params; p = load_species_params(); print(p)"` — prints SpeciesParams with correct values
5. No Streamlit imports anywhere in src/
</verification>

<success_criteria>
- Package installs and all subpackages are importable
- GrowthParams, LightParams, ReactorParams, SpeciesParams are frozen and hashable
- species_params.yaml has every parameter with value + unit + source + note
- load_species_params() returns validated SpeciesParams with correct Chlorella vulgaris values
- ASSUMED parameters are explicitly flagged in YAML notes
- All parameter tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-model/01-01-SUMMARY.md`
</output>
